DATASET:
  GENETIC:
    FIX_PROTOTYPES: True
    MODEL_PATH: NA
    ORDER_NAME: NA
    PROTOTYPE_SHAPE: (0, 0, 0, 0)
    SIZE: 0
    TAXONOMY_NAME: NA
    TRAIN_PATH: NA
    TRAIN_PUSH_DIR: NA
    TRANSFORM: onehot
    VALIDATION_PATH: NA
  IMAGE:
    MODEL_PATH: NA
    PROTOTYPE_SHAPE: (0, 0, 0, 0)
    SIZE: 256
    TEST_DIR: datasets/bioscan/test_diptera
    TRAIN_BATCH_SIZE: 80
    TRAIN_DIR: datasets/bioscan/train_diptera_augmented
    TRAIN_PUSH_DIR: datasets/bioscan/train_diptera
    TRANSFORM_MEAN: (0.485, 0.456, 0.406)
    TRANSFORM_STD: (0.229, 0.224, 0.225)
  NAME: bioscan
  NUM_CLASSES: 40
  TEST_BATCH_SIZE: 100
  TRAIN_BATCH_SIZE: 80
  TRAIN_PUSH_BATCH_SIZE: 75
EXPERIMENT_RUN: 1
MODEL:
  ADD_ON_LAYERS_TYPE: regular
  BACKBONE: resnet50
  DEVICE: cuda
  GENETIC_MODE: False
  PROTOTYPE_ACTIVATION_FUNCTION: log
  PROTOTYPE_DISTANCE_FUNCTION: l2
  PROTOTYPE_SHAPE: (2000, 128, 1, 1)
OPTIM:
  COEFS:
    CLST: 0.8
    CRS_ENT: 1
    L1: 0.0001
    SEP: -0.08
  JOINT_OPTIMIZER_LAYERS:
    ADD_ON_LAYERS: 0.003
    FEATURES: 0.0001
    LR_STEP_SIZE: 5
    PROTOTYPE_VECTORS: 0.003
    WEIGHT_DECAY: 0.001
  LAST_LAYER_OPTIMIZER_LAYERS:
    LR: 0.0001
  NUM_TRAIN_EPOCHS: 100
  NUM_WARM_EPOCHS: 5
  PUSH_EPOCHS: [0, 10, 20, 30, 40, 50, 60, 70, 80, 90]
  PUSH_START: 10
  WARM_OPTIMIZER_LAYERS:
    ADD_ON_LAYERS: 0.003
    PROTOTYPE_VECTORS: 0.003
    WEIGHT_DECAY: 0.001
OUTPUT:
  IMG_DIR: ./saved_models/bioscan/img
  MODEL_DIR: ./saved_models/bioscan
  NO_SAVE: False
  PREPROCESS_INPUT_FUNCTION: None
  PROTOTYPE_IMG_FILENAME_PREFIX: prototype-img
  PROTOTYPE_SELF_ACT_FILENAME_PREFIX: prototype-self-act
  PROTO_BOUND_BOXES_FILENAME_PREFIX: bb
  WEIGHT_MATRIX_FILENAME: outputL_weights
start training
epoch: 	0
	warm
	train
	time: 	753.6976747512817
	cross ent: 	3.431860604286194
	cluster: 	0.7621377115231007
	separation:	0.5743168922979385
	avg separation:	11.090804553031921
	accu: 		9.140625%
	l1: 		41000.0
	p dist pair: 	23.428295135498047
	balanced accu:	0.09140625596046448
	mode: 	train
	test
	time: 	24.878140687942505
	cross ent: 	3.095266103744507
	cluster: 	0.11989411059767008
	separation:	0.04687887104228139
	avg separation:	11.25464916229248
	accu: 		14.875%
	l1: 		41000.0
	p dist pair: 	23.428295135498047
	balanced accu:	0.14874999225139618
	mode: 	test
epoch: 	1
	warm
	train
	time: 	239.789874792099
	cross ent: 	2.8206009244918824
	cluster: 	0.10277628917247057
	separation:	0.047270705127157274
	avg separation:	11.200031810998917
	accu: 		20.3921875%
	l1: 		41000.0
	p dist pair: 	24.27631187438965
	balanced accu:	0.20392189919948578
	mode: 	train
	test
	time: 	6.06506872177124
	cross ent: 	2.7796589955687523
	cluster: 	0.09937070566229522
	separation:	0.03502072743140161
	avg separation:	11.292599618434906
	accu: 		21.6875%
	l1: 		41000.0
	p dist pair: 	24.27631187438965
	balanced accu:	0.21687498688697815
	mode: 	test
epoch: 	2
	warm
	train
	time: 	242.67432522773743
	cross ent: 	2.4645083698630335
	cluster: 	0.08417285051196814
	separation:	0.04549395652487874
	avg separation:	11.090958106517792
	accu: 		28.446875%
	l1: 		41000.0
	p dist pair: 	25.011550903320312
	balanced accu:	0.28446874022483826
	mode: 	train
	test
	time: 	7.969933032989502
	cross ent: 	2.565730571746826
	cluster: 	0.07780788256786764
	separation:	0.041800955310463905
	avg separation:	10.994209706783295
	accu: 		28.749999999999996%
	l1: 		41000.0
	p dist pair: 	25.011550903320312
	balanced accu:	0.2874999940395355
	mode: 	test
epoch: 	3
	warm
	train
	time: 	254.80435991287231
	cross ent: 	2.1885970263183117
	cluster: 	0.07353956720326096
	separation:	0.041150023574009535
	avg separation:	10.936922636032104
	accu: 		36.1578125%
	l1: 		41000.0
	p dist pair: 	25.62833023071289
	balanced accu:	0.3615781366825104
	mode: 	train
	test
	time: 	7.465066909790039
	cross ent: 	2.444561094045639
	cluster: 	0.07366974651813507
	separation:	0.04196829698048532
	avg separation:	10.951547682285309
	accu: 		32.6875%
	l1: 		41000.0
	p dist pair: 	25.62833023071289
	balanced accu:	0.3268750011920929
	mode: 	test
epoch: 	4
	warm
	train
	time: 	243.00839948654175
	cross ent: 	1.927269688397646
	cluster: 	0.06828682355582714
	separation:	0.04053514219354838
	avg separation:	10.716356899738312
	accu: 		43.7296875%
	l1: 		41000.0
	p dist pair: 	25.833667755126953
	balanced accu:	0.43729686737060547
	mode: 	train
	test
/home/users/mb625/miniconda3/envs/protopnet/lib/python3.10/site-packages/torch/optim/lr_scheduler.py:136: UserWarning: Detected call of `lr_scheduler.step()` before `optimizer.step()`. In PyTorch 1.1.0 and later, you should call them in the opposite order: `optimizer.step()` before `lr_scheduler.step()`.  Failure to do this will result in PyTorch skipping the first value of the learning rate schedule. See more details at https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate
  warnings.warn("Detected call of `lr_scheduler.step()` before `optimizer.step()`. "
	time: 	6.070762872695923
	cross ent: 	2.2363994047045708
	cluster: 	0.06821778160519898
	separation:	0.03699948242865503
	avg separation:	10.718332946300507
	accu: 		37.375%
	l1: 		41000.0
	p dist pair: 	25.833667755126953
	balanced accu:	0.3737500011920929
	mode: 	test
epoch: 	5
	joint
	train
	time: 	264.8432946205139
	cross ent: 	0.7639486585278064
	cluster: 	0.05589581553125754
	separation:	0.031224909144220873
	avg separation:	10.520668404102326
	accu: 		77.4453125%
	l1: 		41000.0
	p dist pair: 	25.23472023010254
	balanced accu:	0.7744531035423279
	mode: 	train
	test
	time: 	7.117547035217285
	cross ent: 	2.0245647355914116
	cluster: 	0.033575991983525455
	separation:	0.017414288129657507
	avg separation:	10.178464770317078
	accu: 		53.43750000000001%
	l1: 		41000.0
	p dist pair: 	25.23472023010254
	balanced accu:	0.534375011920929
	mode: 	test
epoch: 	6
	joint
	train
	time: 	266.91801929473877
	cross ent: 	0.1567377327522263
	cluster: 	0.02952887267805636
	separation:	0.014419784639030694
	avg separation:	9.976566178798675
	accu: 		95.2828125%
	l1: 		41000.0
	p dist pair: 	24.5999698638916
	balanced accu:	0.9528281092643738
	mode: 	train
	test
	time: 	7.744287490844727
	cross ent: 	2.049991063773632
	cluster: 	0.023777131573297083
	separation:	0.013373617839533836
	avg separation:	9.712108731269836
	accu: 		56.1875%
	l1: 		41000.0
	p dist pair: 	24.5999698638916
	balanced accu:	0.56187504529953
	mode: 	test
epoch: 	7
	joint
	train
	time: 	269.914293050766
	cross ent: 	0.0967290642450098
	cluster: 	0.027252795847598463
	separation:	0.012313766452716663
	avg separation:	9.744136241674424
	accu: 		97.14375%
	l1: 		41000.0
	p dist pair: 	24.395832061767578
	balanced accu:	0.9714375734329224
	mode: 	train
	test
	time: 	8.721638679504395
	cross ent: 	2.07758217304945
	cluster: 	0.033012341358698905
	separation:	0.012435798475053161
	avg separation:	9.750432670116425
	accu: 		58.5%
	l1: 		41000.0
	p dist pair: 	24.395832061767578
	balanced accu:	0.5850000381469727
	mode: 	test
epoch: 	8
	joint
	train
	time: 	267.0404257774353
	cross ent: 	0.08905452122504358
	cluster: 	0.027029064025264234
	separation:	0.01150220711628208
	avg separation:	9.632930579185485
	accu: 		97.28125%
	l1: 		41000.0
	p dist pair: 	24.668350219726562
	balanced accu:	0.9728124737739563
	mode: 	train
	test
	time: 	6.954211711883545
	cross ent: 	2.1850658506155014
	cluster: 	0.02226422756211832
	separation:	0.008400568796787411
	avg separation:	9.692680180072784
	accu: 		55.6875%
	l1: 		41000.0
	p dist pair: 	24.668350219726562
	balanced accu:	0.5568749904632568
	mode: 	test
epoch: 	9
	joint
	train
	time: 	264.6785559654236
	cross ent: 	0.010278789625408536
	cluster: 	0.011959804152138532
	separation:	0.007275668999645859
	avg separation:	9.749890276193618
	accu: 		99.7703125%
	l1: 		41000.0
	p dist pair: 	24.63912582397461
	balanced accu:	0.9977030754089355
	mode: 	train
	test
	time: 	7.575237989425659
	cross ent: 	1.920159712433815
	cluster: 	0.00960178827517666
	separation:	0.005942730756942183
	avg separation:	9.637910187244415
	accu: 		62.68749999999999%
	l1: 		41000.0
	p dist pair: 	24.63912582397461
	balanced accu:	0.6268750429153442
	mode: 	test
epoch: 	10
	joint
	train
	time: 	263.9114055633545
	cross ent: 	0.002385818079856108
	cluster: 	0.006214324930333533
	separation:	0.004399342138494831
	avg separation:	9.733640530109405
	accu: 		99.965625%
	l1: 		41000.0
	p dist pair: 	24.59695053100586
	balanced accu:	0.9996563196182251
	mode: 	train
	test
	time: 	5.795040845870972
	cross ent: 	1.913569614291191
	cluster: 	0.005126986390678212
	separation:	0.0032338332530343905
	avg separation:	9.62319701910019
	accu: 		62.4375%
	l1: 		41000.0
	p dist pair: 	24.59695053100586
	balanced accu:	0.62437504529953
	mode: 	test
	push
/home/users/mb625/MultiModalPPNet/prototype/push.py:255: RuntimeWarning: invalid value encountered in log
  proto_act_img_j = np.log((proto_dist_img_j + 1) / (proto_dist_img_j + prototype_network_parallel.module.epsilon))
/home/users/mb625/MultiModalPPNet/prototype/push.py:292: RuntimeWarning: invalid value encountered in cast
  heatmap = cv2.applyColorMap(np.uint8(255*rescaled_act_img_j), cv2.COLORMAP_JET)
Traceback (most recent call last):
  File "/home/users/mb625/MultiModalPPNet/main.py", line 141, in <module>
    main()
  File "/home/users/mb625/MultiModalPPNet/main.py", line 105, in main
    push.push_prototypes(
  File "/home/users/mb625/MultiModalPPNet/prototype/push.py", line 87, in push_prototypes
    update_prototypes_on_batch(search_batch_input,
  File "/home/users/mb625/MultiModalPPNet/prototype/push.py", line 223, in update_prototypes_on_batch
    global_min_fmap_patches[j] = batch_min_fmap_patch_j
ValueError: could not broadcast input array from shape (128,1,0) into shape (128,1,1)
